{##
 # assignment_list.twig
 #
 # Lists assignments.
 # @author Dean Inglis <inglisd@mcmaster.ca>
 # @see base_list.twig for parameters
 #}
{% extends "base_list.twig" %}

{% block javascript %}

  {{ parent() }}

  <script type="text/javascript">

    // override base_list functionality to execute an ajax_push to create a new assignment
    // rather than loading an assignment_add template
    $( function () {
      {% if addable %}
        // override the add button
        $( "#{{ widget.full }}_add" ).unbind( 'click' );
        $( "#{{ widget.full }}_add" ).click( function() {
          if( ajax_push( "{{ widget.subject }}", "new" ) ) {
            slot_refresh( {{ slot }} );
          }
        } );
      {% endif %}
    } );

    {% if allow_transcribe %}
      $( function() {
        // make test_entry transcribe button icon
        $( "button.{{ widget.full }}_test_entry_transcribe" ).button( {
          text: false,
          icons: { primary: "ui-icon-pencil" }
        } ).click( function() {
          var args = new Object();
          var id_string = $(this).prop( "id" );
          args.id = parseInt( id_string.substring( id_string.lastIndexOf("_") + 1 ) );
          slot_load( {{ slot }}, "test_entry", "transcribe", args );
        } );
      } );
    {% elseif allow_adjudicate %}
      $( function() {
        $( "button.{{ widget.full }}_test_entry_adjudicate" ).button( {
          text: false,
          icons: { primary: "ui-icon-pencil" }
        } ).click( function() {
          var args = new Object();
          var id_string = $(this).prop( "id" );
          args.id = parseInt( id_string.substring( id_string.lastIndexOf("_") + 1 ) );
          slot_load( {{ slot }}, "test_entry", "adjudicate", args );
        } );
      } );
    {% endif %}

    {% if state_list is defined %}
      $( function() {
        // reload page if state selector is changed
        $( "#{{ widget.full }}__restrict_state_id" ).change( function() {
          var state_id = $( "#{{ widget.full }}__restrict_state_id option:selected" ).val();
          slot_load( {{ slot }}, "{{ widget.subject }}", "{{ widget.name }}",
                     { "restrict_state_id": state_id } );
        } );
      } );

      // reload page if language selector is changed
      $( "#{{ widget.full }}__restrict_language_id" ).change( function() {
        var language_id = $( "#{{ widget.full }}__restrict_language_id option:selected" ).val();
        slot_load( {{ slot }}, "{{ widget.subject }}", "{{ widget.name }}",
                   { "restrict_language_id": language_id } );
      } );
    {% endif %}

  </script>

{% endblock javascript %}

{% block prelist %}

  <div style="padding-top: 4px; padding-bottom: 4px;">
    {% if state_list is defined %}
      <span class="spacer">
        {% set restrict_state_id = restrict_state_id|default(0) %}
        Restrict to condition:
        <select id="{{ widget.full }}__restrict_state_id" class="ui-state-default">
          <option {% if "" == restrict_state_id %}selected{% endif %}
                  value = "">Open</option>
          {% for id, name in state_list %}
            <option {% if id == restrict_state_id %}selected{% endif %}
                    value = "{{ id }}">{{ name }}</option>
          {% endfor %}
        </select>
      </span>

      <span>
        Restrict to language:
        <select id="{{ widget.full }}__restrict_language_id" class="ui-state-default">
          {% for id, language in languages %}
            <option {% if id == restrict_language_id %}selected{% endif %}
                    value="{{ id }}">{{ language }}</option>
          {% endfor %}
        </select>
      </span>
    {% endif %}
  </div>

  {{ parent() }}

{% endblock prelist %}

{% block header_button_columns %}
  <th width="1%"></th>
  {% if allow_adjudicate %}
    <th width="1%"></th>
  {% endif %}
{% endblock header_button_columns %}

{% block button_columns %}

  {% if allow_transcribe %}
    <td>
      <button class="{{ widget.full }}_test_entry_transcribe"
       {{ row.columns['assignment.allow_transcribe'] ? '' : 'disabled' }}
       id="{{ widget.full }}_test_entry_transcribe_{{ row.columns['assignment.test_entry_id'] }}">transcribe</button>
    </td>
  {% elseif allow_adjudicate and row.columns['assignment.test_entry_id'] is defined %}
    <td>
      <button class="{{ widget.full }}_test_entry_adjudicate"
       {{ row.columns['assignment.allow_adjudicate'] ? '' : 'disabled' }}
       id="{{ widget.full }}_test_entry_adjudicate_{{ row.columns['assignment.test_entry_id'] }}">adjudicate</button>
    </td>
  {% else %}
    <td></td>
  {% endif %}

{% endblock button_columns %}

