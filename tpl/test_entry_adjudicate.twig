{##
 # test_entry_adjudicate.twig
 #
 # Extends the base_record template for adjudicating test entries.
 # @author Dean Inglis <inglisd@mcmaster.ca>
 #}
{% extends "base_record.twig" %}

{% block javascript %}

  {{ parent() }}

  <script type="text/javascript">

    $( function () {

      $( "#{{ widget.full }}_submit" ).click( function() {
        // submit the adjudication
        if( ajax_push( "{{ widget.subject }}", "submit", { "id": {{ adjudicate_entry_id }} } ) ) {
          $( "#{{ widget.full }}_submit" ).button( { disabled : true } );
          $( "#{{ widget.full }}_next" ).trigger( "click" );
        }
      } );// end Submit button click

      $( "#{{ widget.full }}_quit" ).click( function() {
        slot_load( {{ slot }}, "assignment", "list" );
      } ); // end Quit click

      $( "#{{ widget.full }}_prev" ).click( function() {
        {% if 0 == prev_test_entry_id %}
          slot_load( {{ slot }}, "assignment", "list" );
        {% else %}
          slot_load( {{ slot }},
            "{{ widget.subject }}", "{{ widget.name }}",
            { id : {{ prev_test_entry_id }} } );
        {% endif %}
      } ).button( { disabled : 1 == {{ rank }} } ); // end Prev click

      $( "#{{ widget.full }}_next" ).click( function() {
        {% if 0 == next_test_entry_id %}
          slot_load( {{ slot }}, "assignment", "list" );
        {% else %}
          slot_load( {{ slot }},
            "{{ widget.subject }}", "{{ widget.name }}",
            { id : {{ next_test_entry_id }} } );
        {% endif %}
      } ); // end Next click

    } );
  </script>

{% endblock javascript %}

{% block record %}

  <div class="spacer"></div>
  <div>
    {% include [ 'test_entry_', test_type, '_adjudicate.twig']|join with test_entry_args %}
  </div>
  <div class="spacer"></div>
  <div id="audio_control">
    {% if recording_data is defined %}
      <table>
        {% set recording_id = 0 %}
        {% for recording in recording_data %}
          <tr>
            <td>
              <audio controls>
                id="{{ widget.full }}__recording__{{ recording_id }}"
                <source src="{{ recording }}" type="audio/wav">
              </audio>
            </td>
          </tr>
          {% set recording_id = recording_id+1 %}
        {% endfor %}
      </table>
    {% endif %}
  </div>
  <div class="spacer"></div>
  <div>
    {% from 'macros.twig' import confirm_buttons %}
      {{ confirm_buttons( slot, widget.full,
        ['submit', 'prev', 'next', 'quit'], '', 'right', true ) }}
  </div>
  <div id="{{ widget.full }}__note_dialog"></div>

{% endblock record %}
